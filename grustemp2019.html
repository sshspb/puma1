<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="/css/grust.css">
  <style>
    .cssHeaderRow { background-color: #9e9e9e; }
    .cssTableRow { background-color: #FAFBFC; }
    .cssOddTableRow { background-color: #F7F8F9; }
    .cssHoverTableRow { background: #ddd; }
    .cssHeaderCell { color: #FFFFFF; font-size: 20px; padding: 10px !important; border: solid 1px #FFFFFF; }
    .cssTableCell { font-size: 20px; padding: 10px !important; border: solid 1px #FFFFFF; text-align: center; }
    .cssRowNumberCell { text-align: center; }
  </style>
<script type="text/javascript" src="/js/charts-loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {packages: ['corechart', 'line', 'table']});
  google.charts.setOnLoadCallback(drawLineColors);

  function drawTable() {
    var url = window.location.href;
    url =  url.substring(0, url.lastIndexOf('/') + 1) + 'lib/weather.json';
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.send();
    xhr.onreadystatechange = function() {
      if (xhr.readyState != 4) return;
      if (xhr.status == 200) {

        var etc = '- " -';
        var date = new Date();
        var mskDateOptions = {
          timeZone: 'Europe/Moscow',
          timeZoneName: 'short', // "short", "long"
          weekday: 'short',      // "narrow", "short", "long"
//          year: 'numeric',       // "numeric", "2-digit"
          month: 'short',        // "numeric", "2-digit", "narrow", "short", "long"
          day: 'numeric',        // "numeric", "2-digit"
          hour: 'numeric',       // "numeric", "2-digit"
          minute: 'numeric',     // "numeric", "2-digit"
          second: 'numeric'      // "numeric", "2-digit"
        };
        var clvDateOptions = {
          timeZone: 'America/New_York',
          timeZoneName: 'short',
          weekday: 'short',
          month: 'short',
          day: 'numeric',
          hour: 'numeric',
          minute: 'numeric',
          second: 'numeric'
        };
        var mskString = date.toLocaleString("ru", mskDateOptions);
        var clvString = date.toLocaleString("ru", clvDateOptions);

        // output the result
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Ср.сут.');
        data.addColumn('string', 'Городок');
        data.addColumn('string', 'Темп');
        data.addColumn('string', 'Давл');
        data.addColumn('string', 'Влажн');
        data.addColumn('string', 'Ветер');
        data.addColumn('string', 'Сейчас');
        var weathers = JSON.parse(xhr.responseText);
        // for the last 24 hours there were 6 measurements
        if (weathers.length > 6) {
          weathers.splice(0, weathers.length - Math.min(6, weathers.length));
        }
        var average = [];
        var weather = weathers[weathers.length - 1];
        for (var township = 0; township < weather.cnt; township++) {
          // average daily temperature
          average[township] = 0;
          for (var sample = 0; sample < weathers.length; sample++) {
            average[township] += weathers[sample].list[township].main.temp;
          }
          average[township] /= weathers.length;
          // current weather
          var deg = weather.list[township].wind.deg;
          var sides = ['С','ССВ','СВ','СВВ','В','ЮВВ','ЮВ','ЮЮВ','Ю','ЮЮЗ','ЮЗ','ЮЮЗ','З','СЗЗ','СЗ','ССЗ', '?'];
          var sec = Math.floor((deg + 11.25) / 22.5);
          sec = sec ? (sec > 15 ? 0 : sec) : 16; //if (sec > 15) sec = 0;
          data.addRow([
            (average[township] - 273.15).toFixed(0).toString(),
            weather.list[township].column,
            (weather.list[township].main.temp - 273.15).toFixed(0).toString(),
            (weather.list[township].main.pressure * 0.75).toFixed(0).toString(), // 760 Torr / 1013.25 bar = 0.75006 Torr/bar
            weather.list[township].main.humidity.toString(),
            weather.list[township].wind.speed.toFixed(1).toString() + '  ' + sides[sec], township == 3 ? clvString : township == 0 ? mskString : etc
          ]);
        }
        var cssClassNames = {
          'headerRow': 'cssHeaderRow',
          'tableRow': 'cssTableRow',
          'oddTableRow': 'cssOddTableRow',
          'selectedTableRow': 'cssSelectedTableRow',
          'hoverTableRow': 'cssHoverTableRow',
          'headerCell': 'cssHeaderCell',
          'tableCell': 'cssTableCell',
          'rowNumberCell': 'cssRowNumberCell'
        };
        var tableOptions = {
          cssClassNames: cssClassNames
        };
        var table = new google.visualization.Table(document.getElementById('weather_table_div'));
        table.draw(data, tableOptions);

        setInterval(function(){ 
          date.setMilliseconds(date.getMilliseconds() + 1000);
          mskString = date.toLocaleString("ru", mskDateOptions);
          clvString = date.toLocaleString("ru", clvDateOptions);
          data.setValue(0, 6, mskString);
          data.setValue(1, 6, clvString);
          table.draw(data, tableOptions);
        }, 1000);

      }
    }
  }

  function drawLineColors() {

      drawTable();
  
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Месяц');
      data.addColumn('number', 'День');
      data.addColumn('number', 'Котёл');
      data.addColumn('number', 'Дом');
      data.addColumn('number', 'Улица');
      data.addRows([
["Апрель 2019",25,0,15.2,15],
["Апрель 2019",24,0,14.2,14],
["Апрель 2019",23,0,13.5,10],
["Апрель 2019",22,0,13.5,8],
["Апрель 2019",21.1,0,14,7],
["Апрель 2019",21,5,14,7],
["Апрель 2019",20,5,14,8],
["Апрель 2019",19,5,12,9],
["Апрель 2019",18.9,0,11.9,9],
["Апрель 2019",18,0,11,7],
["Апрель 2019",17,0,10.5,6],
["Апрель 2019",16,0,10.5,5],
["Апрель 2019",15,0,11,4],
["Апрель 2019",14,0,12,3],
["Апрель 2019",13.1,0,13,2],
["Апрель 2019",13,5,13,2],
["Апрель 2019",12,5,12,1],
["Апрель 2019",11,5,8,0],
["Апрель 2019",10.9,0,8,0],
["Апрель 2019",10,0,9,2],
["Апрель 2019",9,0,10,4],
["Апрель 2019",8,0,11.3,7],
["Апрель 2019",7.1,0,13,7],
["Апрель 2019",7,5,13,7],
["Апрель 2019",6,5,9.3,7],
["Апрель 2019",5.9,0,9.3,7],
["Апрель 2019",5,0,9.2,7],
["Апрель 2019",4,0,9.2,6],
["Апрель 2019",3,0,9.5,4],
["Апрель 2019",2,0,10,3],
["Апрель 2019",1,0,11,2],
["Апрель 2019",0,0,13,2],
["Март 2019",31,5,13,2],
["Март 2019",30,5,8.4,5],
["Март 2019",29,5,8.1,5],
["Март 2019",28,5,7.7,1],
["Март 2019",27,5,7.6,-2],
["Март 2019",26,5,8,0],
["Март 2019",25,5,8.2,2],
["Март 2019",24,5,8.1,2],
["Март 2019",23,5,8,2],
["Март 2019",22,5,7.8,3],
["Март 2019",21,5,7.6,3],
["Март 2019",20,5,7.4,1],
["Март 2019",19,5,7.2,2],
["Март 2019",18,5,7,3],
["Март 2019",17,5,6.8,2],
["Март 2019",16,5,6.6,1],
["Март 2019",15,5,6.3,0],
["Март 2019",14,5,6.1,-2],
["Март 2019",13,5,6,-4],
["Март 2019",12,5,6.1,-5],
["Март 2019",11,5,6.2,-3],
["Март 2019",10,5,6.3,1],
["Март 2019",9,5,6,2],
["Март 2019",8,5,5.5,4],
["Март 2019",7,5,5,-5],
["Март 2019",6,5,5.1,-9],
["Март 2019",5,5,5.2,-4],
["Март 2019",4,5,5.4,-6],
["Март 2019",3,5,5.6,-4],
["Март 2019",2,5,5.9,-6],
["Март 2019",1,5,6.2,-3],
["Март 2019",0,5,6.5,2],
["Февраль 2019",29,5,6,-3],
["Февраль 2019",28,5,6.5,2],
["Февраль 2019",27,5,6.5,0],
["Февраль 2019",26,5,6.4,2],
["Февраль 2019",25,5,6,3],
["Февраль 2019",24,5,5.6,1],
["Февраль 2019",23,5,5.5,-5],
["Февраль 2019",22,5,5.5,-7],
["Февраль 2019",21,5,5.8,-5],
["Февраль 2019",20,5,6,2],
["Февраль 2019",19,5,6.5,-1],
["Февраль 2019",18,5,6.8,-3],
["Февраль 2019",17,5,7,2],
["Февраль 2019",16,7,6.9,3],
["Февраль 2019",15,7,6.9,3],
["Февраль 2019",14,7,6.9,0],
["Февраль 2019",13,7,6.9,-2],
["Февраль 2019",12,7,6.6,1],
["Февраль 2019",11,7,6,2],
["Февраль 2019",10,7,5.5,2],
["Февраль 2019",9,7,5.2,-0],
["Февраль 2019",8,7,5,-3],
["Февраль 2019",7,7,5,-8],
["Февраль 2019",6,7,5,-3],
["Февраль 2019",5,7,5,-3],
["Февраль 2019",4,7,5,-0],
["Февраль 2019",3,7,5,-3],
["Февраль 2019",2,7,5,-3],
["Февраль 2019",1,7,5,-6],
["Февраль 2019",0,7,5,0],
["Январь 2019",31,7,5,0],
["Январь 2019",30,7,3,-4],
["Январь 2019",29,7,2,-13],
["Январь 2019",28,7,2,-16],
["Январь 2019",27,7,2,-12],
["Январь 2019",26,7,2,-14],
["Январь 2019",25,7,3,-17],
["Январь 2019",24,7,2,-10],
["Январь 2019",23,7,2,-14],
["Январь 2019",22,7,2,-18],
["Январь 2019",21,7,3,-12],
["Январь 2019",20,7,4,-5],
["Январь 2019",19,7,4,-12],
["Январь 2019",18,7,5,-6],
["Январь 2019",17,7,5,-4],
["Январь 2019",16,7,6,-4],
["Январь 2019",15,7,6,-1],
["Январь 2019",14,7,5,-2],
["Январь 2019",13,10,4,-6],
["Январь 2019",12,10,5,-1],
["Январь 2019",11,10,4,-5],
["Январь 2019",10,10,4,-5],
["Январь 2019",9,10,5,-3],
["Январь 2019",8,10,5,-3],
["Январь 2019",7,10,4,-3],
["Январь 2019",6,10,5,-8],
["Январь 2019",5,10,5,-2],
["Январь 2019",4,10,5,-2],
["Январь 2019",3,10,5,-2],
["Январь 2019",2,10,5,-2],
["Январь 2019",1,10,5,-2],
["Январь 2019",0,10,5,-2]
      ]);
      
      var options1 = options2 = options3 = options4 = {
        hAxis: {ticks: [0,5,10,15,20,25,30], minorGridlines: {count: 4} },
        fontSize: 20,
        chartArea: {left:75, right:150}, 
        titlePosition: 'out',
        titleTextStyle: {color: '#707070' },
        width: 960, 
        height: 400, 
        lineWidth: 4,
        colors: [ '#FF7100', '#a52714', '#093871'] 
      };

      options1.title = "Январь 2019";
      options1.vAxis = {ticks: [-15,-10,-5,0,5,10], minorGridlines: {count: 4} };
      var view1 = new google.visualization.DataView(data);
      view1.setRows(view1.getFilteredRows([{column: 0, value: "Январь 2019"}]));
      view1.setColumns([1, 2, 3, 4]);
      var chart1 = new google.visualization.LineChart(document.getElementById('chart_div1'));
      chart1.draw(view1, options1);

      options2.title = "Февраль 2019";
      options2.vAxis = {ticks: [-10,-5,0,5,10], minorGridlines: {count: 4} };
      var view2 = new google.visualization.DataView(data);
      view2.setRows(view2.getFilteredRows([{column: 0, value: "Февраль 2019"}]));
      view2.setColumns([1, 2, 3, 4]);
      var chart2 = new google.visualization.LineChart(document.getElementById('chart_div2'));
      chart2.draw(view2, options2);
      
      options3.title = "Март 2019";
      options3.vAxis = {ticks: [-10,-5,0,5,10,15], minorGridlines: {count: 4} };
      var view3 = new google.visualization.DataView(data);
      view3.setRows(view3.getFilteredRows([{column: 0, value: "Март 2019"}]));
      view3.setColumns([1, 2, 3, 4]);
      var chart3 = new google.visualization.LineChart(document.getElementById('chart_div3'));
      chart3.draw(view3, options3);

      options4.title = "Апрель 2019";
      options4.vAxis = {ticks: [0,5,10,15], minorGridlines: {count: 4} };
      // options4.colors = [ '#a52714', '#093871'] 
      var view4 = new google.visualization.DataView(data);
      view4.setRows(view4.getFilteredRows([{column: 0, value: options4.title}]));
      view4.setColumns([1, 2, 3, 4]);
      // view4.setColumns([1, 3, 4]);
      var chart4 = new google.visualization.LineChart(document.getElementById('chart_div4'));
      chart4.draw(view4, options4);
      
      var cssClassNames = {
          'headerRow': 'cssHeaderRow',
          'tableRow': 'cssTableRow',
          'oddTableRow': 'cssOddTableRow',
          'selectedTableRow': 'cssSelectedTableRow',
          'hoverTableRow': 'cssHoverTableRow',
          'headerCell': 'cssHeaderCell',
          'tableCell': 'cssTableCell',
          'rowNumberCell': 'cssRowNumberCell'
      };
      var tableOptions = {
          width: '100%', 
          height: '400px',
          cssClassNames: cssClassNames
      };
      var viewTable= new google.visualization.DataView(data);
      var table = new google.visualization.Table(document.getElementById('table_div'));
      table.draw(viewTable, tableOptions);
  }
</script>

</head>
<body style="background-color: #d0d8e0;">
  <div style="background-color: #FFF; width:960px; margin: auto; ">
    <figure style="width:100%; height:212px; margin:0 auto 10px; ">
      <img src="/images/grustemp.jpg" alt="The head and torso of a landowner" 
      title="The Landowner Inspects the Territory">
    </figure>
    <div id="weather_table_div" style="width:100%; padding-left:30px; background-color: #F7F8F9;" ></div>
    <div id="chart_div4"></div>
    <div id="chart_div3"></div>
    <div id="chart_div2"></div>
    <div id="chart_div1"></div>
    <div id="table_div" style="padding: 0 20% 0 10%;"></div>
    <footer style="background-color: #9e9e9e;">
      <p style="text-align: center; color: #FFFFFF; font-size: 20px; padding: 5px;">Журавлиное</p>
    </footer>
  </div>
</body>
</html>

<!--
Time Changes in Cleveland Over the Years

2019	вск 11 мар г. 02:00	EST → EDT	+1 hour (DST start)	UTC-4h  1520751600 UTC
      вск 4 ноя г. 02:00	EDT → EST	-1 hour (DST end)	UTC-5h    1541311200 UTC
2019	вск 10 мар г. 02:00	EST → EDT	+1 hour (DST start)	UTC-4h
      вск 3 ноя г. 02:00	EDT → EST	-1 hour (DST end)	UTC-5h
2020	вск 8 мар г. 02:00	EST → EDT	+1 hour (DST start)	UTC-4h
      вск 1 ноя г. 02:00	EDT → EST	-1 hour (DST end)	UTC-5h
2021	вск 14 мар г. 02:00	EST → EDT	+1 hour (DST start)	UTC-4h
      вск 7 ноя г. 02:00	EDT → EST	-1 hour (DST end)	UTC-5h
-->
